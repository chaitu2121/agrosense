/* AGROSENSE UNIFIED 360¬∞ INTELLIGENCE ENGINE */

function jumpTo(id){
  const el = document.getElementById(id);
  if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
}

function openFarmCulture(){
  window.open("https://huggingface.co/spaces/Chaitu2121/farmculture-ai", "_blank");
}

function filterCrops(){
  const search = document.getElementById("cropSearch").value.toLowerCase();
  const cropSelect = document.getElementById("crop");
  const options = cropSelect.options;

  for(let i=0; i<options.length; i++){
    if(i === 0) continue;
    const txt = options[i].text.toLowerCase();
    options[i].style.display = txt.includes(search) ? "" : "none";
  }
}

function showQuickAdvice(){
  const season = document.getElementById("season").value;
  const crop = document.getElementById("crop").value;
  const soil = document.getElementById("soil").value;
  const water = document.getElementById("water").value;
  const box = document.getElementById("quickAdvice");

  if(!season || !crop || !soil || !water){
    box.innerHTML = "Complete all selections for advice.";
    return;
  }

  let advice = "System stable. Monitor soil moisture and weather.";

  if(water === "rain") advice = "Rain dependent: choose drought tolerant crops.";
  if(soil === "sandy") advice = "Sandy soil: use mulching and frequent irrigation.";

  const waterHeavy = ["rice","sugarcane","banana"];
  if(waterHeavy.includes(crop) && water === "rain")
    advice = "High risk: high-water crop under rainfed condition.";

  box.innerHTML = advice;
}

function analyzeRisk(){
  const season = document.getElementById("season").value;
  const crop = document.getElementById("crop").value;
  const soil = document.getElementById("soil").value;
  const water = document.getElementById("water").value;

  if(!season || !crop || !soil || !water){
    document.getElementById("riskResult").innerHTML =
      "‚ö†Ô∏è Complete Season, Crop, Soil and Water first.";
    return;
  }

  let climateScore = 80;
  let waterScore = 80;
  let soilScore = 80;
  let fertilizerScore = 75;
  let marketScore = 75;
  let resilienceScore = 70;

  if(season === "summer") climateScore -= 25;
  if(season === "monsoon") climateScore += 5;

  if(water === "rain") waterScore -= 30;
  if(water === "drip") waterScore += 10;

  if(soil === "sandy") soilScore -= 20;
  if(soil === "loamy") soilScore += 5;

  const nitrogenHeavy = ["rice","sugarcane","cotton"];
  if(nitrogenHeavy.includes(crop)) fertilizerScore -= 15;

  const volatile = ["tomato","onion","chilli"];
  if(volatile.includes(crop)) marketScore -= 20;

  const droughtCrops = ["bajra","jowar","ragi","gram","tur"];
  if(droughtCrops.includes(crop)) resilienceScore += 20;

  const finalScore = Math.round(
    (climateScore + waterScore + soilScore + fertilizerScore + marketScore + resilienceScore) / 6
  );

  let classification = "Future Stable";
  if(finalScore < 70) classification = "Moderate Risk";
  if(finalScore < 50) classification = "High Strategic Risk";

  document.getElementById("riskResult").innerHTML = `
    <h3>üåç AgroSense 360¬∞ Strategic Report</h3>
    Final Score: ${finalScore}/100 <br>
    Classification: ${classification}
  `;

  showQuickAdvice();
}

function saveNotes(){
  const text = document.getElementById("notesBox").value;
  localStorage.setItem("agrosense_notes", text);
  document.getElementById("notesStatus").innerHTML = "Notes saved.";
}

function clearNotes(){
  localStorage.removeItem("agrosense_notes");
  document.getElementById("notesBox").value = "";
  document.getElementById("notesStatus").innerHTML = "Notes cleared.";
}

window.onload = function(){
  const saved = localStorage.getItem("agrosense_notes");
  if(saved){
    document.getElementById("notesBox").value = saved;
  }
};
